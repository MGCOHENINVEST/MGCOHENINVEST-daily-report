{% if bond_analytics %}
  <h3 style="margin-top:18px;">Bond Analytics</h3>

  <table role="presentation" cellpadding="0" cellspacing="0" style="border-collapse:collapse;width:100%;max-width:680px;">
    <tr>
      <td style="padding:8px 0;">
        <div style="font-size:14px;line-height:1.4;">
          <strong>Total bonds:</strong> {{ bond_analytics.count }}
          {% if bond_analytics.avg_ytm is not none %} · <strong>Avg YTM:</strong> {{ '%.2f' % bond_analytics.avg_ytm }}%{% endif %}
          {% if bond_analytics.avg_running_yield is not none %} · <strong>Avg running:</strong> {{ '%.2f' % bond_analytics.avg_running_yield }}%{% endif %}
          {% if bond_analytics.avg_duration_mod is not none %} · <strong>Avg mod dur:</strong> {{ '%.2f' % bond_analytics.avg_duration_mod }}y{% endif %}
        </div>
      </td>
    </tr>
  </table>

  <!-- Ladder -->
  {% set L = bond_analytics.ladder %}
  {% if L %}
  <table role="presentation" cellpadding="0" cellspacing="0" style="border-collapse:collapse;width:100%;max-width:680px;margin-top:6px;border:1px solid #eee;">
    <tr>
      <td colspan="5" style="background:#fafafa;border-bottom:1px solid #eee;padding:8px 10px;font-weight:600;">Ladder (count by bucket)</td>
    </tr>
    <tr>
      {% for bucket in ['0-1y','1-3y','3-5y','5-10y','10y+'] %}
      <td style="padding:10px;text-align:center;border-right:1px solid #eee;">
        <div style="font-size:12px;color:#666;">{{ bucket }}</div>
        <div style="font-size:16px;font-weight:700;">{{ L.get(bucket,0) }}</div>
      </td>
      {% endfor %}
    </tr>
  </table>
  {% endif %}

  <!-- Next maturities -->
  {% if bond_analytics.next_maturities %}
  <table role="presentation" cellpadding="0" cellspacing="0" style="border-collapse:collapse;width:100%;max-width:680px;margin-top:10px;border:1px solid #eee;">
    <tr>
      <td colspan="4" style="background:#fafafa;border-bottom:1px solid #eee;padding:8px 10px;font-weight:600;">Next maturities</td>
    </tr>
    <tr>
      <th align="left" style="padding:8px 10px;border-bottom:1px solid #eee;font-size:12px;color:#666;">Ticker</th>
      <th align="left" style="padding:8px 10px;border-bottom:1px solid #eee;font-size:12px;color:#666;">Issuer</th>
      <th align="left" style="padding:8px 10px;border-bottom:1px solid #eee;font-size:12px;color:#666;">Maturity</th>
      <th align="right" style="padding:8px 10px;border-bottom:1px solid #eee;font-size:12px;color:#666;">YTM</th>
    </tr>
    {% for b in bond_analytics.next_maturities %}
    <tr>
      <td style="padding:8px 10px;border-bottom:1px solid #f2f2f2;">{{ b.ticker or b.isin }}</td>
      <td style="padding:8px 10px;border-bottom:1px solid #f2f2f2;">{{ b.issuer }}</td>
      <td style="padding:8px 10px;border-bottom:1px solid #f2f2f2;">{{ b.maturity }}</td>
      <td align="right" style="padding:8px 10px;border-bottom:1px solid #f2f2f2;">{% if b.ytm is not none %}{{ '%.2f' % b.ytm }}%{% else %}&nbsp;{% endif %}</td>
    </tr>
    {% endfor %}
  </table>
  {% endif %}
{% endif %}
